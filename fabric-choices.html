<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Choose your path — from Fabric</title>
  <link rel="stylesheet" href="choices.css?v=3" />
</head>
<body>
  <a href="index.html" class="back-button">← Back</a>

  <section class="screen-choices" aria-label="Where will you wander next?">
    <div class="choice-question">Where will you wander next?</div>

    <div id="optMesh" class="choice" tabindex="0" role="link" data-target="fabric-mesh.html">
      <img class="choice-img" src="mesh.png" alt="" />
      <div class="choice-content"><h3 class="choice-text">Move through the Mesh environment</h3></div>
    </div>

    <div id="optCeiling" class="choice" tabindex="0" role="link" data-target="fabric-ceiling.html">
      <img class="choice-img" src="ceiling.png" alt="" />
      <div class="choice-content"><h3 class="choice-text">Look up at the Wooden Ceiling</h3></div>
    </div>

    <div id="orLabel" class="choice-or" aria-hidden="true">OR</div>

    <div id="singleWrap" class="final-wrap" hidden>
      <img id="singleImg" class="final-img" src="" alt="" />
      <div class="final-overlay">
        <h2 id="singleTitle" class="final-title"></h2>
        <button id="singleGo" class="final-continue" type="button">Continue</button>
      </div>
    </div>
  </section>

  <div class="screen-fade" aria-hidden="true"></div>

  <script>
  const fade = document.querySelector('.screen-fade');
  const go = (url) => { fade.classList.add('in'); setTimeout(()=>location.href=url, 250); };

  document.querySelectorAll('.choice').forEach(el=>{
    el.addEventListener('click',()=>go(el.dataset.target));
    el.addEventListener('keydown',e=>{ if(e.key==='Enter'||e.key===' '){e.preventDefault();go(el.dataset.target);} });
  });

  // Single-option mode via ?only=mesh|ceiling
  const params = new URLSearchParams(location.search);
  const only = (params.get('only') || '').toLowerCase();

  if (only) {
    document.querySelector('.screen-choices').classList.add('single');

    document.getElementById('optMesh').setAttribute('hidden','');
    document.getElementById('optCeiling').setAttribute('hidden','');
    document.getElementById('orLabel').setAttribute('hidden','');

    const wrap = document.getElementById('singleWrap');
    const img  = document.getElementById('singleImg');
    const ttl  = document.getElementById('singleTitle');
    const btn  = document.getElementById('singleGo');

    if (only === 'mesh') {
      img.src = 'mesh.png';
      ttl.textContent = 'Proceed to the Mesh environment';
      btn.onclick = ()=> go('fabric-mesh.html');                 // not final
    } else { // only === 'ceiling'  → FINAL hop
      img.src = 'ceiling.png';
      ttl.textContent = 'Proceed to the Wooden Ceiling';
      btn.onclick = ()=> go('fabric-ceiling.html?final=1');      // tell transition this is final
    }
    wrap.hidden = false;
  }
</script>

</body>
</html>
