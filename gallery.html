<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Felt Image — All Scenes</title>  <!-- gallery.html -->
  <link rel="stylesheet" href="gallery.css?v=2" />
</head>
<body>
  <a href="index.html" class="back-button">← Back</a>

  <header class="gallery-header">
  <h1>All Scenes</h1>
  <p>Use ← / → or swipe. Videos auto-play silently when in view; tap to pause.</p>
  <p class="counter" id="counter" aria-live="polite">1 of 12</p>
</header>

  <main class="carousel" aria-label="Media Carousel">
    <button class="nav prev" aria-label="Previous item">‹</button>

    <div class="track" id="track" tabindex="0">
      <!-- IMAGES -->
      <figure class="slide">
        <img src="fuzzy.png" alt="Fuzzy space" loading="lazy" />
        <figcaption>Fuzzy — image</figcaption>
      </figure>

      <figure class="slide">
        <img src="fabric.png" alt="Fabric space" loading="lazy" />
        <figcaption>Fabric — image</figcaption>
      </figure>

      <figure class="slide">
        <img src="mesh.png" alt="Mesh space" loading="lazy" />
        <figcaption>Mesh — image</figcaption>
      </figure>

      <figure class="slide">
        <img src="ceiling.png" alt="Wooden Ceiling" loading="lazy" />
        <figcaption>Wooden Ceiling — image</figcaption>
      </figure>

      <!-- VIDEOS (muted + playsinline for iOS auto-play) -->
      <figure class="slide">
        <video class="vid" playsinline muted loop preload="metadata" poster="fabric.png" src="fuzzy-fabric.mp4"></video>
        <figcaption>Transition — Fuzzy → Fabric</figcaption>
      </figure>

      <figure class="slide">
        <video class="vid" playsinline muted loop preload="metadata" poster="mesh.png" src="fuzzy-mesh.mp4"></video>
        <figcaption>Transition — Fuzzy → Mesh</figcaption>
      </figure>

      <figure class="slide">
        <video class="vid" playsinline muted loop preload="metadata" poster="mesh.png" src="fabric-mesh.mp4"></video>
        <figcaption>Transition — Fabric → Mesh</figcaption>
      </figure>

      <figure class="slide">
        <video class="vid" playsinline muted loop preload="metadata" poster="ceiling.png" src="fabric-ceiling.mp4"></video>
        <figcaption>Transition — Fabric → Wooden Ceiling</figcaption>
      </figure>

      <figure class="slide">
        <video class="vid" playsinline muted loop preload="metadata" poster="fabric.png" src="mesh-fabric.mp4"></video>
        <figcaption>Transition — Mesh → Fabric</figcaption>
      </figure>

      <figure class="slide">
        <video class="vid" playsinline muted loop preload="metadata" poster="ceiling.png" src="mesh-ceiling.mp4"></video>
        <figcaption>Transition — Mesh → Wooden Ceiling</figcaption>
      </figure>

      <figure class="slide">
        <video class="vid" playsinline muted loop preload="metadata" poster="fabric.png" src="ceiling-fabric.mp4"></video>
        <figcaption>Transition — Wooden Ceiling → Fabric</figcaption>
      </figure>

      <figure class="slide">
        <video class="vid" playsinline muted loop preload="metadata" poster="mesh.png" src="ceiling-mesh.mp4"></video>
        <figcaption>Transition — Wooden Ceiling → Mesh</figcaption>
      </figure>
    </div>

    <button class="nav next" aria-label="Next item">›</button>
  </main>

  <div class="dots" id="dots" aria-label="Slide navigation"></div>

  <script>
  const track = document.getElementById('track');
  const slides = Array.from(track.querySelectorAll('.slide'));
  const prevBtn = document.querySelector('.nav.prev');
  const nextBtn = document.querySelector('.nav.next');
  const dotsWrap = document.getElementById('dots');
  const counter = document.getElementById('counter');
  const total = slides.length;

  // Give slides stable ids for a11y connections
  slides.forEach((s, i) => { s.id = `slide-${i+1}`; });

  // Dots: accessible tablist
  dotsWrap.setAttribute('role', 'tablist');
  const dots = slides.map((_, i) => {
    const b = document.createElement('button');
    b.className = 'dot';
    b.type = 'button';
    b.setAttribute('role', 'tab');
    b.setAttribute('aria-controls', `slide-${i+1}`);
    b.setAttribute('aria-label', `Go to item ${i+1} of ${total}`);
    b.addEventListener('click', () => goTo(i));
    b.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); goTo(i); }
      if (e.key === 'ArrowRight') goTo(Math.min(i+1, total-1));
      if (e.key === 'ArrowLeft')  goTo(Math.max(i-1, 0));
    });
    dotsWrap.appendChild(b);
    return b;
  });

  function goTo(i){
    const idx = Math.max(0, Math.min(i, slides.length-1));
    const behavior = window.matchMedia('(prefers-reduced-motion: reduce)').matches ? 'auto' : 'smooth';
    track.scrollTo({ left: slides[idx].offsetLeft, behavior });
  }

  // Keep UI in sync + video auto play/pause
  let active = 0;
  const io = new IntersectionObserver((entries) => {
    entries.forEach(e => {
      const i = slides.indexOf(e.target);
      if (e.isIntersecting) {
        active = i;
        updateUI();
        const v = e.target.querySelector('video');
        if (v && !window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
          try { v.play(); } catch(_) {}
        }
      } else {
        const v = e.target.querySelector('video');
        if (v) { try { v.pause(); } catch(_) {} }
      }
    });
  }, { root: track, threshold: 0.6 });
  slides.forEach(s => io.observe(s));

  function updateUI(){
    dots.forEach((d,i)=>{
      const on = i===active;
      d.classList.toggle('active', on);
      d.setAttribute('aria-selected', on ? 'true' : 'false');
      if (on) d.setAttribute('aria-current', 'true'); else d.removeAttribute('aria-current');
    });
    prevBtn.disabled = active===0;
    nextBtn.disabled = active===slides.length-1;
    if (counter) counter.textContent = `${active+1} of ${total}`;
  }
  updateUI();

  // Nav + keyboard on track
  prevBtn.addEventListener('click', () => goTo(active-1));
  nextBtn.addEventListener('click', () => goTo(active+1));
  track.addEventListener('keydown', (e)=>{
    if(e.key==='ArrowRight') goTo(active+1);
    if(e.key==='ArrowLeft')  goTo(active-1);
    if(e.key==='Home')       goTo(0);
    if(e.key==='End')        goTo(total-1);
    if(e.key===' '){ // space toggles current video
      const v = slides[active].querySelector('video');
      if (v){ e.preventDefault(); v.paused ? v.play() : v.pause(); }
    }
  });

  // Tap to toggle a video
  track.addEventListener('click', (e)=>{
    const v = e.target.closest('video'); if(!v) return;
    v.paused ? v.play() : v.pause();
  });

  // Keep snap aligned on resize
  addEventListener('resize', ()=> goTo(active));
</script>

</body>
</html>
