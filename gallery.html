<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Felt Image — All Scenes</title>
  <link rel="stylesheet" href="gallery.css?v=3" />
</head>
<body>
  <a href="index.html" class="back-button">← Back</a>

  <header class="gallery-header">
    <h1>All Scenes</h1>
    <p>Use ← / → or swipe. Videos auto-play silently when in view; tap to pause.</p>
    <p class="counter" id="counter" aria-live="polite">1 of 1</p>
  </header>

  <main class="carousel" aria-label="Media Carousel">
    <button class="nav prev" aria-label="Previous item">‹</button>

    <div class="track" id="track" tabindex="0">
      <!-- IMAGES (first three with quick “open” links) -->
      <figure class="slide">
        <img src="fuzzy.png" alt="Fuzzy space" loading="lazy" />
        <figcaption>Fuzzy — image <span class="sep">·</span> <a class="open-link" href="fuzzy.html" aria-label="Open Scene 1 — Fuzzy Sensory Layer">Open this scene →</a></figcaption>
      </figure>

      <figure class="slide">
        <img src="fabric.png" alt="Fabric space" loading="lazy" />
        <figcaption>Fabric — image <span class="sep">·</span> <a class="open-link" href="fabric.html" aria-label="Open Scene 2 — Fabric / Texture">Open this scene →</a></figcaption>
      </figure>

      <figure class="slide">
        <img src="mesh.png" alt="Mesh space" loading="lazy" />
        <figcaption>Mesh — image <span class="sep">·</span> <a class="open-link" href="mesh.html" aria-label="Open Scene 3 — Mesh Maze">Open this scene →</a></figcaption>
      </figure>

      <!-- VIDEOS: keep all your existing <figure class="slide">…</figure> blocks below as-is -->
      <figure class="slide">
        <video class="vid" playsinline muted loop preload="metadata" poster="fuzzy.png" src="fuzzy-fabric.mp4"></video>
        <figcaption>Transition — Fuzzy → Fabric</figcaption>
      </figure>

      <figure class="slide">
        <video class="vid" playsinline muted loop preload="metadata" poster="fabric.png" src="fabric-mesh.mp4"></video>
        <figcaption>Transition — Fabric → Mesh</figcaption>
      </figure>

      <figure class="slide">
        <video class="vid" playsinline muted loop preload="metadata" poster="mesh.png" src="mesh-fuzzy.mp4"></video>
        <figcaption>Transition — Mesh → Fuzzy</figcaption>
      </figure>

      <!-- …(leave the rest of your transitions here unchanged)… -->
    </div>

    <div class="dots" id="dots" aria-label="Slide navigation"></div>

    <button class="nav next" aria-label="Next item">›</button>
  </main>

  <script>
    const track = document.getElementById('track');
    const slides = Array.from(track.querySelectorAll('.slide'));
    const prevBtn = document.querySelector('.nav.prev');
    const nextBtn = document.querySelector('.nav.next');
    const dotsWrap = document.getElementById('dots');
    const counter = document.getElementById('counter');

    // dots + ids
    slides.forEach((s, i) => {
      s.id = `slide-${i+1}`;
      const b = document.createElement('button');
      b.className = 'dot'; b.type = 'button';
      b.setAttribute('role','tab'); b.setAttribute('aria-controls', `slide-${i+1}`);
      b.setAttribute('aria-label', `Go to item ${i+1}`);
      b.addEventListener('click', () => goTo(i));
      dotsWrap.appendChild(b);
    });
    const dots = Array.from(dotsWrap.querySelectorAll('.dot'));

    function goTo(i){
      const idx = Math.max(0, Math.min(i, slides.length-1));
      const behavior = window.matchMedia('(prefers-reduced-motion: reduce)').matches ? 'auto' : 'smooth';
      track.scrollTo({ left: slides[idx].offsetLeft, behavior });
    }

    // watch which slide is centered; play/pause videos
    let active = 0;
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(e => {
        const i = slides.indexOf(e.target);
        if (e.isIntersecting) {
          active = i;
          updateUI();
          const v = e.target.querySelector('video');
          if (v && !window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
            try { v.play(); } catch(_) {}
          }
        } else {
          const v = e.target.querySelector('video');
          if (v) { try { v.pause(); } catch(_) {} }
        }
      });
    }, { root: track, threshold: 0.6 });
    slides.forEach(s => observer.observe(s));

    function updateUI(){
      dots.forEach((d,i)=>d.classList.toggle('active', i===active));
      prevBtn.disabled = active===0;
      nextBtn.disabled = active===slides.length-1;
      if (counter) counter.textContent = `${active+1} of ${slides.length}`;
    }
    updateUI();

    // controls & keyboard
    prevBtn.addEventListener('click', () => goTo(active-1));
    nextBtn.addEventListener('click', () => goTo(active+1));
    track.addEventListener('keydown', (e)=>{
      if(e.key==='ArrowRight') goTo(active+1);
      if(e.key==='ArrowLeft')  goTo(active-1);
      if(e.key==='Home')       goTo(0);
      if(e.key==='End')        goTo(slides.length-1);
      if(e.key===' '){
        const v = slides[active].querySelector('video');
        if (v){ e.preventDefault(); v.paused ? v.play() : v.pause(); }
      }
    });

    // tap to toggle a video
    track.addEventListener('click', (e)=>{
      const v = e.target.closest('video'); if(!v) return;
      v.paused ? v.play() : v.pause();
    });

    addEventListener('resize', ()=> goTo(active));
  </script>
</body>
</html>
